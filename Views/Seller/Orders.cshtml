@model JohnHenryFashionWeb.ViewModels.OrderListViewModel
@{
    ViewData["Title"] = "Quản lý đơn hàng";
    Layout = "~/Views/Shared/_SellerLayout.cshtml";
}

<div class="admin-content">
    <!-- Page Header -->
    <div class="admin-page-header">
        <div class="admin-page-header-content">
            <div>
                <h1 class="admin-page-title">
                    <i data-lucide="shopping-cart" class="me-2"></i>
                    Quản lý đơn hàng
                </h1>
                <p class="admin-page-description">Theo dõi và xử lý các đơn hàng của bạn</p>
            </div>
            <div class="admin-page-actions">
                <button type="button" class="admin-btn admin-btn-outline">
                    <i data-lucide="download" class="me-2"></i>
                    Xuất báo cáo
                </button>
            </div>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="admin-filters">
        <form method="get" class="admin-filters-form">
            <div class="admin-search-box">
                <i data-lucide="search"></i>
                <input type="text" name="search" value="@Model.SearchTerm" 
                       placeholder="Mã đơn hàng, tên khách hàng..." class="admin-search-input">
            </div>
            
            <select name="status" class="admin-form-select" onchange="this.form.submit()">
                <option value="">Tất cả trạng thái</option>
                @{
                    var statusOptions = new[] {
                        new { Value = "pending", Text = "Chờ xử lý" },
                        new { Value = "processing", Text = "Đang xử lý" },
                        new { Value = "shipped", Text = "Đã gửi" },
                        new { Value = "delivered", Text = "Đã giao" },
                        new { Value = "cancelled", Text = "Đã hủy" }
                    };
                }
                @foreach (var option in statusOptions)
                {
                    <option value="@option.Value" selected="@(Model.Status == option.Value)">@option.Text</option>
                }
            </select>
            
            <input type="date" name="fromDate" value="@Model.FromDate?.ToString("yyyy-MM-dd")" 
                   class="admin-form-input" placeholder="Từ ngày">
            
            <input type="date" name="toDate" value="@Model.ToDate?.ToString("yyyy-MM-dd")" 
                   class="admin-form-input" placeholder="Đến ngày">
            
            <button type="submit" class="admin-btn admin-btn-primary">
                <i data-lucide="filter" class="me-1"></i>
                Lọc
            </button>
        </form>
    </div>

    <!-- Filter Tabs -->
    <div class="admin-filter-tabs mb-4">
        <a href="@Url.Action("Orders", new { status = "", search = Model.SearchTerm, fromDate = Model.FromDate, toDate = Model.ToDate })" 
           class="admin-filter-tab @(string.IsNullOrEmpty(Model.Status) ? "active" : "")">
            Tất cả
        </a>
        <a href="@Url.Action("Orders", new { status = "pending", search = Model.SearchTerm, fromDate = Model.FromDate, toDate = Model.ToDate })" 
           class="admin-filter-tab @(Model.Status == "pending" ? "active" : "")">
            Chờ xử lý
        </a>
        <a href="@Url.Action("Orders", new { status = "processing", search = Model.SearchTerm, fromDate = Model.FromDate, toDate = Model.ToDate })" 
           class="admin-filter-tab @(Model.Status == "processing" ? "active" : "")">
            Đang xử lý
        </a>
        <a href="@Url.Action("Orders", new { status = "shipped", search = Model.SearchTerm, fromDate = Model.FromDate, toDate = Model.ToDate })" 
           class="admin-filter-tab @(Model.Status == "shipped" ? "active" : "")">
            Đã gửi
        </a>
        <a href="@Url.Action("Orders", new { status = "delivered", search = Model.SearchTerm, fromDate = Model.FromDate, toDate = Model.ToDate })" 
           class="admin-filter-tab @(Model.Status == "delivered" ? "active" : "")">
            Đã giao
        </a>
    </div>

    <!-- Orders Table -->
    @if (Model.Orders.Any())
    {
        <div class="admin-table-wrapper">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th style="width: 130px;">Mã đơn hàng</th>
                        <th>Khách hàng</th>
                        <th style="width: 80px;">Số lượng</th>
                        <th style="width: 120px;">Tổng tiền</th>
                        <th style="width: 120px;">Trạng thái</th>
                        <th style="width: 120px;">Thanh toán</th>
                        <th style="width: 140px;">Ngày đặt</th>
                        <th style="width: 180px;">Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var order in Model.Orders)
                    {
                        <tr>
                            <td>
                                <code class="text-primary fw-semibold">@order.OrderNumber</code>
                            </td>
                            <td>
                                <div>
                                    <div class="fw-semibold">@order.CustomerName</div>
                                    <small class="text-muted">@order.CustomerEmail</small>
                                </div>
                            </td>
                            <td class="text-center">
                                <span class="admin-badge admin-badge-secondary">@order.ItemCount</span>
                            </td>
                            <td>
                                <span class="fw-semibold text-success">@order.Total.ToString("N0") ₫</span>
                            </td>
                            <td>
                                @switch (order.Status.ToLower())
                                {
                                    case "pending":
                                        <span class="admin-badge admin-badge-warning">Chờ xử lý</span>
                                        break;
                                    case "processing":
                                        <span class="admin-badge admin-badge-info">Đang xử lý</span>
                                        break;
                                    case "shipped":
                                        <span class="admin-badge admin-badge-primary">Đã gửi</span>
                                        break;
                                    case "delivered":
                                        <span class="admin-badge admin-badge-success">Đã giao</span>
                                        break;
                                    case "cancelled":
                                        <span class="admin-badge admin-badge-danger">Đã hủy</span>
                                        break;
                                    default:
                                        <span class="admin-badge admin-badge-secondary">@order.Status</span>
                                        break;
                                }
                            </td>
                            <td>
                                @switch (order.PaymentStatus.ToLower())
                                {
                                    case "paid":
                                        <span class="admin-badge admin-badge-success">Đã thanh toán</span>
                                        break;
                                    case "pending":
                                        <span class="admin-badge admin-badge-warning">Chờ thanh toán</span>
                                        break;
                                    case "failed":
                                        <span class="admin-badge admin-badge-danger">Thất bại</span>
                                        break;
                                    case "refunded":
                                        <span class="admin-badge admin-badge-info">Đã hoàn tiền</span>
                                        break;
                                    default:
                                        <span class="admin-badge admin-badge-secondary">@order.PaymentStatus</span>
                                        break;
                                }
                            </td>
                            <td>
                                <small class="text-muted">@order.CreatedAt.ToString("dd/MM/yyyy HH:mm")</small>
                            </td>
                            <td>
                                <div class="admin-table-actions">
                                    <a href="@Url.Action("OrderDetail", "Seller", new { id = order.Id })" 
                                       class="admin-btn admin-btn-sm admin-btn-outline" title="Chi tiết">
                                        <i data-lucide="eye"></i>
                                    </a>
                                    @if (order.Status == "pending")
                                    {
                                        <button class="admin-btn admin-btn-sm admin-btn-success" 
                                                onclick="updateOrderStatus('@order.Id', 'processing')" title="Duyệt đơn">
                                            <i data-lucide="check"></i>
                                        </button>
                                    }
                                    else if (order.Status == "processing")
                                    {
                                        <button class="admin-btn admin-btn-sm admin-btn-primary" 
                                                onclick="updateOrderStatus('@order.Id', 'shipped')" title="Gửi hàng">
                                            <i data-lucide="truck"></i>
                                        </button>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        @if (Model.TotalPages > 1)
        {
            <div class="admin-pagination">
                <div class="admin-pagination-info">
                    Hiển thị trang @Model.CurrentPage / @Model.TotalPages
                </div>
                <div class="admin-pagination-buttons">
                    @if (Model.CurrentPage > 1)
                    {
                        <a href="@Url.Action("Orders", new { page = 1, search = Model.SearchTerm, status = Model.Status, fromDate = Model.FromDate, toDate = Model.ToDate })" 
                           class="admin-pagination-btn" title="Trang đầu">
                            <i data-lucide="chevrons-left"></i>
                        </a>
                        <a href="@Url.Action("Orders", new { page = Model.CurrentPage - 1, search = Model.SearchTerm, status = Model.Status, fromDate = Model.FromDate, toDate = Model.ToDate })" 
                           class="admin-pagination-btn" title="Trang trước">
                            <i data-lucide="chevron-left"></i>
                        </a>
                    }
                    else
                    {
                        <span class="admin-pagination-btn disabled">
                            <i data-lucide="chevrons-left"></i>
                        </span>
                        <span class="admin-pagination-btn disabled">
                            <i data-lucide="chevron-left"></i>
                        </span>
                    }

                    @{
                        var startPage = Math.Max(1, Model.CurrentPage - 2);
                        var endPage = Math.Min(Model.TotalPages, Model.CurrentPage + 2);
                    }

                    @for (int i = startPage; i <= endPage; i++)
                    {
                        if (i == Model.CurrentPage)
                        {
                            <span class="admin-pagination-btn active">@i</span>
                        }
                        else
                        {
                            <a href="@Url.Action("Orders", new { page = i, search = Model.SearchTerm, status = Model.Status, fromDate = Model.FromDate, toDate = Model.ToDate })" 
                               class="admin-pagination-btn">@i</a>
                        }
                    }

                    @if (Model.CurrentPage < Model.TotalPages)
                    {
                        <a href="@Url.Action("Orders", new { page = Model.CurrentPage + 1, search = Model.SearchTerm, status = Model.Status, fromDate = Model.FromDate, toDate = Model.ToDate })" 
                           class="admin-pagination-btn" title="Trang tiếp">
                            <i data-lucide="chevron-right"></i>
                        </a>
                        <a href="@Url.Action("Orders", new { page = Model.TotalPages, search = Model.SearchTerm, status = Model.Status, fromDate = Model.FromDate, toDate = Model.ToDate })" 
                           class="admin-pagination-btn" title="Trang cuối">
                            <i data-lucide="chevrons-right"></i>
                        </a>
                    }
                    else
                    {
                        <span class="admin-pagination-btn disabled">
                            <i data-lucide="chevron-right"></i>
                        </span>
                        <span class="admin-pagination-btn disabled">
                            <i data-lucide="chevrons-right"></i>
                        </span>
                    }
                </div>
            </div>
        }
    }
    else
    {
        <div class="empty-state">
            <i data-lucide="inbox" style="width: 64px; height: 64px;"></i>
            <h4 class="mt-3 mb-2">Chưa có đơn hàng nào</h4>
            <p class="text-muted mb-4">Các đơn hàng sẽ hiển thị tại đây khi có khách đặt mua</p>
        </div>
    }
</div>

@section Scripts {
    <script>
        // Initialize Lucide icons
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
        });

        function updateOrderStatus(orderId, newStatus) {
            const statusText = {
                'processing': 'duyệt đơn hàng',
                'shipped': 'đánh dấu đã gửi hàng'
            };
            
            if (confirm(`Bạn có chắc chắn muốn ${statusText[newStatus] || 'cập nhật trạng thái'}?`)) {
                // TODO: Implement AJAX call to update order status
                // For now, we'll just reload the page
                window.location.reload();
            }
        }
    </script>
}
