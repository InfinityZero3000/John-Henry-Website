@model JohnHenryFashionWeb.ViewModels.UserEditViewModel
@{
    ViewData["Title"] = "Chỉnh sửa người dùng";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewData["Breadcrumb"] = "<li class=\"breadcrumb-item\"><a href=\"" + Url.Action("Users") + "\">Người dùng</a></li><li class=\"breadcrumb-item\"><a href=\"" + Url.Action("UserDetail", new { id = Model.Id }) + "\">Chi tiết</a></li><li class=\"breadcrumb-item active\">Chỉnh sửa</li>";
}

<div class="admin-content">
    <!-- Page Header -->
    <div class="admin-page-header">
        <div class="admin-flex-between">
            <h1 class="admin-page-title">
                <i data-lucide="edit"></i>
                Chỉnh sửa người dùng
            </h1>
            <div style="display: flex; gap: 0.5rem;">
                <a href="@Url.Action("UserDetail", new { id = Model.Id })" class="admin-btn admin-btn-secondary">
                    <i data-lucide="arrow-left"></i>
                    Quay lại
                </a>
            </div>
        </div>
    </div>

    <form asp-action="EditUser" asp-route-id="@Model.Id" method="post" enctype="multipart/form-data">
        <div class="row g-4">
            <!-- Main Form -->
            <div class="col-lg-8">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h5 class="admin-card-title">
                            <i data-lucide="user"></i>
                            Thông tin cá nhân
                        </h5>
                    </div>
                    <div class="admin-card-body">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
                        
                        <input type="hidden" asp-for="Id" />

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="admin-form-group">
                                    <label asp-for="FirstName" class="admin-form-label">
                                        Họ <span style="color: var(--admin-danger);">*</span>
                                    </label>
                                    <input asp-for="FirstName" class="admin-form-input" placeholder="VD: Nguyễn">
                                    <span asp-validation-for="FirstName" class="admin-form-error"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="admin-form-group">
                                    <label asp-for="LastName" class="admin-form-label">
                                        Tên <span style="color: var(--admin-danger);">*</span>
                                    </label>
                                    <input asp-for="LastName" class="admin-form-input" placeholder="VD: Văn A">
                                    <span asp-validation-for="LastName" class="admin-form-error"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="admin-form-group">
                                    <label asp-for="Email" class="admin-form-label">
                                        Email <span style="color: var(--admin-danger);">*</span>
                                    </label>
                                    <input asp-for="Email" type="email" class="admin-form-input" placeholder="user@example.com" readonly>
                                    <small class="form-text text-muted">Email không thể thay đổi</small>
                                    <span asp-validation-for="Email" class="admin-form-error"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="admin-form-group">
                                    <label asp-for="PhoneNumber" class="admin-form-label">
                                        Số điện thoại
                                    </label>
                                    <input asp-for="PhoneNumber" class="admin-form-input" placeholder="0901234567">
                                    <span asp-validation-for="PhoneNumber" class="admin-form-error"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="admin-form-group">
                                    <label asp-for="DateOfBirth" class="admin-form-label">
                                        Ngày sinh
                                    </label>
                                    <input asp-for="DateOfBirth" type="date" class="admin-form-input">
                                    <span asp-validation-for="DateOfBirth" class="admin-form-error"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="admin-form-group">
                                    <label asp-for="Gender" class="admin-form-label">
                                        Giới tính
                                    </label>
                                    <select asp-for="Gender" class="admin-form-select">
                                        <option value="">Chọn giới tính</option>
                                        <option value="Nam">Nam</option>
                                        <option value="Nữ">Nữ</option>
                                        <option value="Khác">Khác</option>
                                    </select>
                                    <span asp-validation-for="Gender" class="admin-form-error"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="admin-form-group">
                                    <label asp-for="Address" class="admin-form-label">
                                        Địa chỉ
                                    </label>
                                    <textarea asp-for="Address" class="admin-form-input" rows="3" placeholder="Nhập địa chỉ"></textarea>
                                    <span asp-validation-for="Address" class="admin-form-error"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Roles Section -->
                <div class="admin-card mt-4">
                    <div class="admin-card-header">
                        <h5 class="admin-card-title">
                            <i data-lucide="shield"></i>
                            Vai trò
                        </h5>
                    </div>
                    <div class="admin-card-body">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Vai trò người dùng</label>
                            <div class="row g-2">
                                @foreach (var role in Model.AvailableRoles)
                                {
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" 
                                                   name="SelectedRoles" value="@role" 
                                                   id="role_@role"
                                                   @(Model.SelectedRoles.Contains(role) ? "checked" : "")>
                                            <label class="form-check-label" for="role_@role">
                                                @role
                                            </label>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Status Card -->
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h5 class="admin-card-title">
                            <i data-lucide="settings"></i>
                            Trạng thái
                        </h5>
                    </div>
                    <div class="admin-card-body">
                        <div class="admin-form-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" asp-for="IsActive" id="isActive">
                                <label class="form-check-label" for="isActive">
                                    Tài khoản đang hoạt động
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Avatar Card -->
                @if (!string.IsNullOrEmpty(Model.CurrentAvatarUrl))
                {
                    <div class="admin-card mt-4">
                        <div class="admin-card-header">
                            <h5 class="admin-card-title">
                                <i data-lucide="image"></i>
                                Avatar hiện tại
                            </h5>
                        </div>
                        <div class="admin-card-body text-center">
                            <img src="@Model.CurrentAvatarUrl" alt="Avatar" 
                                 style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid var(--admin-border);">
                        </div>
                    </div>
                }

                <!-- Actions -->
                <div class="admin-card mt-4">
                    <div class="admin-card-body">
                        <div class="d-grid gap-2">
                            <button type="submit" class="admin-btn admin-btn-primary">
                                <i data-lucide="save"></i>
                                Lưu thay đổi
                            </button>
                            <a href="@Url.Action("UserDetail", new { id = Model.Id })" class="admin-btn admin-btn-secondary">
                                <i data-lucide="x"></i>
                                Hủy
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
}

