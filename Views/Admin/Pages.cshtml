@{
    ViewData["Title"] = "Quản lý trang";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="admin-content">
    <!-- Header Section -->
    <div class="admin-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-file-alt me-2"></i>Quản lý trang
                </h1>
                <p class="text-muted mb-0">Quản lý nội dung trang tĩnh và CMS</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="createPage()">
                    <i class="fas fa-plus me-1"></i>Tạo trang mới
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Section -->
    <div class="content-wrapper">
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">12</h4>
                                <p class="card-text">Tổng số trang</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-file-alt fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">8</h4>
                                <p class="card-text">Đã xuất bản</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-check-circle fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">3</h4>
                                <p class="card-text">Bản nháp</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-edit fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">1</h4>
                                <p class="card-text">Chờ duyệt</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-clock fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters and Search -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <input type="text" class="form-control" placeholder="Tìm kiếm trang..." id="searchPages">
                    </div>
                    <div class="col-md-2">
                        <select class="form-select" id="statusFilter">
                            <option value="">Tất cả trạng thái</option>
                            <option value="published">Đã xuất bản</option>
                            <option value="draft">Bản nháp</option>
                            <option value="pending">Chờ duyệt</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select class="form-select" id="typeFilter">
                            <option value="">Tất cả loại</option>
                            <option value="page">Trang thường</option>
                            <option value="blog">Blog</option>
                            <option value="policy">Chính sách</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select class="form-select" id="sortBy">
                            <option value="updated">Cập nhật gần nhất</option>
                            <option value="created">Ngày tạo</option>
                            <option value="title">Tên trang</option>
                            <option value="views">Lượt xem</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-outline-secondary w-100" onclick="resetFilters()">
                            <i class="fas fa-sync me-1"></i>Đặt lại
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pages Table -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Danh sách trang</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Tiêu đề</th>
                                <th>Loại</th>
                                <th>Trạng thái</th>
                                <th>Tác giả</th>
                                <th>Lượt xem</th>
                                <th>Cập nhật</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div>
                                        <h6 class="mb-0">Giới thiệu về chúng tôi</h6>
                                        <small class="text-muted">/about-us</small>
                                    </div>
                                </td>
                                <td><span class="badge bg-primary">Trang thường</span></td>
                                <td><span class="badge bg-success">Đã xuất bản</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-circle me-2">AD</div>
                                        <span>Admin</span>
                                    </div>
                                </td>
                                <td>1,234</td>
                                <td>
                                    <div>15/09/2024</div>
                                    <small class="text-muted">10:30</small>
                                </td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="viewPage('about-us')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="editPage('about-us')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-success" onclick="duplicatePage('about-us')">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="deletePage('about-us')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div>
                                        <h6 class="mb-0">Chính sách bảo mật</h6>
                                        <small class="text-muted">/privacy-policy</small>
                                    </div>
                                </td>
                                <td><span class="badge bg-info">Chính sách</span></td>
                                <td><span class="badge bg-success">Đã xuất bản</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-circle me-2">AD</div>
                                        <span>Admin</span>
                                    </div>
                                </td>
                                <td>892</td>
                                <td>
                                    <div>14/09/2024</div>
                                    <small class="text-muted">16:45</small>
                                </td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="viewPage('privacy-policy')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="editPage('privacy-policy')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-success" onclick="duplicatePage('privacy-policy')">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="deletePage('privacy-policy')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div>
                                        <h6 class="mb-0">Hướng dẫn mua hàng</h6>
                                        <small class="text-muted">/shopping-guide</small>
                                    </div>
                                </td>
                                <td><span class="badge bg-primary">Trang thường</span></td>
                                <td><span class="badge bg-warning">Bản nháp</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-circle me-2">ED</div>
                                        <span>Editor</span>
                                    </div>
                                </td>
                                <td>0</td>
                                <td>
                                    <div>13/09/2024</div>
                                    <small class="text-muted">09:15</small>
                                </td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="previewPage('shopping-guide')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="editPage('shopping-guide')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-success" onclick="publishPage('shopping-guide')">
                                            <i class="fas fa-upload"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="deletePage('shopping-guide')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div>
                                        <h6 class="mb-0">Xu hướng thời trang 2024</h6>
                                        <small class="text-muted">/fashion-trends-2024</small>
                                    </div>
                                </td>
                                <td><span class="badge bg-secondary">Blog</span></td>
                                <td><span class="badge bg-info">Chờ duyệt</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-circle me-2">AU</div>
                                        <span>Author</span>
                                    </div>
                                </td>
                                <td>0</td>
                                <td>
                                    <div>12/09/2024</div>
                                    <small class="text-muted">14:20</small>
                                </td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="previewPage('fashion-trends-2024')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="editPage('fashion-trends-2024')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-success" onclick="approvePage('fashion-trends-2024')">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-warning" onclick="rejectPage('fashion-trends-2024')">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Page Quick Actions Modal -->
<div class="modal fade" id="quickActionsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thao tác nhanh</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="quickActionsContent">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>
</div>

<script>
    function createPage() {
        window.location.href = '/admin/pages/create';
    }

    function viewPage(slug) {
        window.open(`/pages/${slug}`, '_blank');
    }

    function previewPage(slug) {
        window.open(`/preview/pages/${slug}`, '_blank');
    }

    function editPage(slug) {
        window.location.href = `/admin/pages/${slug}/edit`;
    }

    function duplicatePage(slug) {
        if (confirm('Bạn có muốn tạo bản sao của trang này?')) {
            fetch(`/admin/api/pages/${slug}/duplicate`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Trang đã được sao chép thành công!');
                    location.reload();
                } else {
                    alert('Có lỗi xảy ra: ' + data.message);
                }
            });
        }
    }

    function publishPage(slug) {
        if (confirm('Bạn có muốn xuất bản trang này?')) {
            fetch(`/admin/api/pages/${slug}/publish`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Trang đã được xuất bản thành công!');
                    location.reload();
                } else {
                    alert('Có lỗi xảy ra: ' + data.message);
                }
            });
        }
    }

    function approvePage(slug) {
        if (confirm('Bạn có muốn duyệt trang này?')) {
            fetch(`/admin/api/pages/${slug}/approve`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Trang đã được duyệt và xuất bản!');
                    location.reload();
                } else {
                    alert('Có lỗi xảy ra: ' + data.message);
                }
            });
        }
    }

    function rejectPage(slug) {
        const reason = prompt('Lý do từ chối:');
        if (reason) {
            fetch(`/admin/api/pages/${slug}/reject`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: JSON.stringify({ reason: reason })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Trang đã bị từ chối!');
                    location.reload();
                } else {
                    alert('Có lỗi xảy ra: ' + data.message);
                }
            });
        }
    }

    function deletePage(slug) {
        if (confirm('Bạn có chắc chắn muốn xóa trang này? Hành động này không thể hoàn tác.')) {
            fetch(`/admin/api/pages/${slug}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Trang đã được xóa thành công!');
                    location.reload();
                } else {
                    alert('Có lỗi xảy ra: ' + data.message);
                }
            });
        }
    }

    function resetFilters() {
        document.getElementById('searchPages').value = '';
        document.getElementById('statusFilter').value = '';
        document.getElementById('typeFilter').value = '';
        document.getElementById('sortBy').value = 'updated';
        applyFilters();
    }

    function applyFilters() {
        // Implementation for filtering pages
        const search = document.getElementById('searchPages').value.toLowerCase();
        const status = document.getElementById('statusFilter').value;
        const type = document.getElementById('typeFilter').value;
        const sortBy = document.getElementById('sortBy').value;
        
        // Filter and sort logic would go here
        console.log('Applying filters:', { search, status, type, sortBy });
    }

    // Event listeners for filters
    document.getElementById('searchPages').addEventListener('input', applyFilters);
    document.getElementById('statusFilter').addEventListener('change', applyFilters);
    document.getElementById('typeFilter').addEventListener('change', applyFilters);
    document.getElementById('sortBy').addEventListener('change', applyFilters);
</script>

<style>
    .avatar-circle {
        width: 32px;
        height: 32px;
        background-color: #6c757d;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.8rem;
        text-transform: uppercase;
    }

    .table th {
        font-weight: 600;
        border-bottom: 2px solid #dee2e6;
    }

    .badge {
        font-size: 0.75em;
    }

    .btn-group .btn {
        margin: 0 1px;
    }

    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        border: 1px solid rgba(0, 0, 0, 0.125);
    }
</style>