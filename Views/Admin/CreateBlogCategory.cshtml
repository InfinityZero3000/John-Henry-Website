@model JohnHenryFashionWeb.Models.BlogCategory

@{
    ViewData["Title"] = "Tạo danh mục blog";
    ViewData["CurrentSection"] = "Blog";
    ViewData["PageIcon"] = "folder-plus";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="admin-content">
    <!-- Page Header -->
    <div class="admin-page-header">
        <div class="admin-page-header-content">
            <h1 class="admin-page-title">
                <i data-lucide="folder-plus"></i>
                Tạo danh mục blog mới
            </h1>
        </div>
        <div class="admin-page-header-actions">
            <a href="@Url.Action("Blog", "Admin")" class="admin-btn admin-btn-secondary">
                <i data-lucide="arrow-left"></i>
                Quay lại
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="admin-card">
                <div class="admin-card-header">
                    <h3><i data-lucide="info"></i> Thông tin danh mục blog</h3>
                </div>
                <div class="admin-card-body">
                    <form asp-action="CreateBlogCategory" method="post" enctype="multipart/form-data">
                        <div asp-validation-summary="ModelOnly" class="admin-alert admin-alert-danger"></div>

                        <div class="admin-form-group">
                            <label asp-for="Name" class="admin-form-label">
                                Tên danh mục <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Name" class="admin-form-control" placeholder="Nhập tên danh mục blog..." id="Name" />
                            <span asp-validation-for="Name" class="text-danger"></span>
                            <small class="admin-form-help">
                                Tên danh mục sẽ hiển thị trên website và được sử dụng để phân loại bài viết blog.
                            </small>
                        </div>

                        <div class="admin-form-group">
                            <label asp-for="Slug" class="admin-form-label">
                                Slug (URL thân thiện)
                            </label>
                            <input asp-for="Slug" class="admin-form-control" placeholder="ten-danh-muc-blog" id="Slug" />
                            <span asp-validation-for="Slug" class="text-danger"></span>
                            <small class="admin-form-help">
                                Slug sẽ được tự động tạo từ tên danh mục nếu để trống. Ví dụ: "tin-tuc-thoi-trang"
                            </small>
                        </div>

                        <div class="admin-form-group">
                            <label asp-for="Description" class="admin-form-label">
                                Mô tả
                            </label>
                            <textarea asp-for="Description" class="admin-form-control" rows="4" 
                                      placeholder="Nhập mô tả ngắn gọn về danh mục này..."></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                            <small class="admin-form-help">
                                Mô tả sẽ hiển thị trên trang danh mục và có thể được sử dụng cho SEO.
                            </small>
                        </div>

                        <div class="admin-form-group">
                            <label for="ParentId" class="admin-form-label">
                                Danh mục cha
                            </label>
                            <select name="ParentId" class="admin-form-select select2" style="width: 100%;">
                                <option value="">-- Không có danh mục cha --</option>
                                @* Sẽ được load từ Controller *@
                            </select>
                            <small class="admin-form-help">
                                Chọn danh mục cha nếu đây là danh mục con.
                            </small>
                        </div>

                        <div class="admin-form-group">
                            <label for="ImageFile" class="admin-form-label">
                                Hình ảnh đại diện
                            </label>
                            <input type="file" class="admin-form-control" id="ImageFile" name="ImageFile" accept="image/*">
                            <small class="admin-form-help">
                                Định dạng: JPG, PNG, GIF. Kích thước khuyến nghị: 800x600px.
                            </small>
                        </div>

                        <div class="admin-form-group">
                            <label asp-for="SortOrder" class="admin-form-label">
                                Thứ tự hiển thị
                            </label>
                            <input asp-for="SortOrder" type="number" class="admin-form-control" min="0" value="0" />
                            <span asp-validation-for="SortOrder" class="text-danger"></span>
                            <small class="admin-form-help">
                                Số thứ tự hiển thị danh mục (0 = hiển thị đầu tiên).
                            </small>
                        </div>

                        <div class="admin-form-group">
                            <div class="admin-form-check">
                                <input asp-for="IsActive" class="admin-form-check-input" type="checkbox" checked />
                                <label asp-for="IsActive" class="admin-form-check-label">
                                    Kích hoạt danh mục
                                </label>
                            </div>
                            <small class="admin-form-help">
                                Danh mục chỉ hiển thị trên website khi được kích hoạt.
                            </small>
                        </div>

                        <div class="admin-form-actions">
                            <button type="submit" class="admin-btn admin-btn-primary">
                                <i data-lucide="save"></i> Tạo danh mục
                            </button>
                            <a href="@Url.Action("Blog", "Admin")" class="admin-btn admin-btn-secondary">
                                <i data-lucide="x"></i> Hủy
                            </a>
                        </div>
                    </form>
                    </div>
            </div>
        </div>

        <div class="col-md-4">
            <!-- Hướng dẫn -->
            <div class="admin-card">
                <div class="admin-card-header">
                    <h3><i data-lucide="help-circle"></i> Hướng dẫn</h3>
                </div>
                <div class="admin-card-body">
                    <div class="admin-alert admin-alert-info">
                        <h6><i data-lucide="lightbulb"></i> Mẹo tạo danh mục hiệu quả:</h6>
                        <ul class="mb-0">
                            <li>Tên danh mục nên ngắn gọn, dễ hiểu</li>
                            <li>Sử dụng mô tả để giải thích rõ nội dung</li>
                            <li>Chọn hình ảnh phù hợp với chủ đề</li>
                            <li>Sắp xếp thứ tự hiển thị hợp lý</li>
                        </ul>
                    </div>
                    
                    <div class="admin-alert admin-alert-warning mt-3">
                        <h6><i data-lucide="alert-triangle"></i> Lưu ý:</h6>
                        <ul class="mb-0">
                            <li>Slug phải là duy nhất</li>
                            <li>Tên danh mục không được trùng lặp</li>
                            <li>Danh mục cha không thể là chính nó</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Xem trước -->
            <div class="admin-card">
                <div class="admin-card-header">
                    <h3><i data-lucide="eye"></i> Xem trước hình ảnh</h3>
                </div>
                <div class="admin-card-body text-center">
                    <img id="imagePreview" src="/images/placeholder-category.jpg" 
                         alt="Xem trước" class="img-fluid rounded" 
                         style="max-height: 200px; display: none;">
                    <p id="noImageText" class="text-muted">Chưa chọn hình ảnh</p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Tự động tạo slug từ tên danh mục
        document.getElementById('Name').addEventListener('input', function() {
            var name = this.value;
            var slug = name.toLowerCase()
                .replace(/[àáạảãâầấậẩẫăằắặẳẵ]/g, 'a')
                .replace(/[èéẹẻẽêềếệểễ]/g, 'e')
                .replace(/[ìíịỉĩ]/g, 'i')
                .replace(/[òóọỏõôồốộổỗơờớợởỡ]/g, 'o')
                .replace(/[ùúụủũưừứựửữ]/g, 'u')
                .replace(/[ỳýỵỷỹ]/g, 'y')
                .replace(/đ/g, 'd')
                .replace(/[^a-z0-9 -]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-+|-+$/g, '');
                
            var slugInput = document.getElementById('Slug');
            if (slugInput.value === '' || slugInput.dataset.autoGenerated === 'true') {
                slugInput.value = slug;
                slugInput.dataset.autoGenerated = 'true';
            }
        });

        // Đánh dấu slug được nhập thủ công
        document.getElementById('Slug').addEventListener('input', function() {
            this.dataset.autoGenerated = 'false';
        });

        // Xem trước hình ảnh
        document.getElementById('ImageFile').addEventListener('change', function() {
            var file = this.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                    document.getElementById('noImageText').style.display = 'none';
                }
                reader.readAsDataURL(file);
            } else {
                document.getElementById('imagePreview').style.display = 'none';
                document.getElementById('noImageText').style.display = 'block';
            }
        });

        // Validation cho slug
        document.getElementById('Slug').addEventListener('blur', function() {
            var slug = this.value;
            if (slug && !/^[a-z0-9-]+$/.test(slug)) {
                alert('Slug chỉ được chứa chữ cái thường, số và dấu gạch ngang!');
                this.focus();
            }
        });
    </script>
}
