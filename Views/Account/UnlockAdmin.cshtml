@model JohnHenryFashionWeb.ViewModels.UnlockAdminViewModel
@{
    ViewData["Title"] = "Mở khóa tài khoản Admin";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-6">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-danger text-white text-center py-4">
                    <i data-lucide="shield-alert" class="mb-2" style="width: 48px; height: 48px;"></i>
                    <h4 class="mb-0 mt-2">Mở khóa tài khoản Admin</h4>
                    <p class="mb-0 mt-2 small opacity-75">Trang khẩn cấp - Chỉ dành cho Admin</p>
                </div>
                <div class="card-body p-4">
                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                            @TempData["SuccessMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i data-lucide="alert-circle" style="width: 20px; height: 20px;"></i>
                            @TempData["ErrorMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                    <div class="alert alert-warning mb-4">
                        <i data-lucide="alert-triangle" style="width: 20px; height: 20px;"></i>
                        <strong>Lưu ý:</strong> Trang này chỉ dùng để mở khóa tài khoản Admin khi bị khóa do nhập sai mật khẩu quá nhiều lần. 
                        Bạn cần có mã bảo mật để sử dụng tính năng này.
                    </div>

                    <form asp-action="UnlockAdmin" method="post">
                        @Html.AntiForgeryToken()
                        
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                        <div class="mb-3">
                            <label asp-for="Email" class="form-label">
                                <i data-lucide="mail" style="width: 18px; height: 18px;"></i>
                                Email Admin
                            </label>
                            <input asp-for="Email" class="form-control form-control-lg" 
                                   placeholder="admin@example.com" autofocus />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="SecretKey" class="form-label">
                                <i data-lucide="key" style="width: 18px; height: 18px;"></i>
                                Mã bảo mật
                            </label>
                            <input asp-for="SecretKey" type="password" class="form-control form-control-lg" 
                                   placeholder="Nhập mã bảo mật" />
                            <span asp-validation-for="SecretKey" class="text-danger"></span>
                            <small class="form-text text-muted">
                                Mã bảo mật được cấu hình trong appsettings.json (Security:AdminUnlockSecret)
                            </small>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-danger btn-lg">
                                <i data-lucide="unlock" style="width: 20px; height: 20px;"></i>
                                Mở khóa tài khoản
                            </button>
                            <a href="@Url.Action("Login", "Account")" class="btn btn-outline-secondary">
                                <i data-lucide="arrow-left" style="width: 18px; height: 18px;"></i>
                                Quay lại trang đăng nhập
                            </a>
                        </div>
                    </form>

                    <hr class="my-4">

                    <div class="text-center">
                        <small class="text-muted">
                            <i data-lucide="info" style="width: 16px; height: 16px;"></i>
                            Nếu bạn không có mã bảo mật, vui lòng liên hệ với quản trị viên hệ thống.
                        </small>
                    </div>
                </div>
            </div>

            <!-- Security Notice -->
            <div class="card mt-3 border-warning">
                <div class="card-body p-3">
                    <div class="d-flex align-items-start">
                        <i data-lucide="shield-check" class="text-warning me-2" style="width: 20px; height: 20px; flex-shrink: 0; margin-top: 2px;"></i>
                        <div>
                            <strong class="text-warning">Thông tin bảo mật:</strong>
                            <ul class="mb-0 mt-2 small text-muted">
                                <li>Mã bảo mật được lưu trong file cấu hình và không được chia sẻ công khai</li>
                                <li>Tất cả các lần mở khóa đều được ghi log để theo dõi</li>
                                <li>Chỉ tài khoản có vai trò Admin mới có thể được mở khóa qua trang này</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        // Initialize Lucide icons
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    </script>
}

