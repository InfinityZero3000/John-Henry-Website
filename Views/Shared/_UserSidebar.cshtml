@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> UserManager

@{
    var currentUser = await UserManager.GetUserAsync(User);
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString()?.ToLower();
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString()?.ToLower();
    
    // Determine active menu item
    var isProfile = currentController == "userdashboard" && currentAction == "profile";
    var isOrders = currentController == "userdashboard" && currentAction == "orders";
    var isWishlist = currentController == "wishlist";
    var isAddresses = currentController == "account" && currentAction == "addresses";
    var isChangePassword = currentController == "account" && currentAction == "changepassword";
    var isNotifications = currentController == "userdashboard" && currentAction == "notifications";
}

<nav class="col-md-3 col-lg-2 d-md-block user-sidebar">
    <div class="sidebar-content">
        <div class="text-center mb-3">
            <div class="user-avatar">
                <img src="@(currentUser?.Avatar ?? "/images/default-avatar.svg")" alt="Avatar" class="rounded-circle"
                     onerror="this.onerror=null; this.src='/images/default-avatar.svg';">
            </div>
            <h5 class="mt-2 mb-1">@(currentUser?.FullName ?? "User")</h5>
            <p class="text-muted small mb-3">@currentUser?.Email</p>
        </div>
        
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link @(isProfile ? "active" : "")" href="@Url.Action("Profile", "UserDashboard")">
                    <i data-lucide="user" class="me-2"></i>
                    Hồ sơ 
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link @(isOrders ? "active" : "")" href="@Url.Action("Orders", "UserDashboard")">
                    <i data-lucide="shopping-bag" class="me-2"></i>
                    Đơn hàng 
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link @(isWishlist ? "active" : "")" href="/Wishlist">
                    <i data-lucide="heart" class="me-2"></i>
                    Yêu thích
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link @(isAddresses ? "active" : "")" href="@Url.Action("Addresses", "Account")">
                    <i data-lucide="map-pin" class="me-2"></i>
                    Địa chỉ
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link @(isChangePassword ? "active" : "")" href="@Url.Action("ChangePassword", "Account")">
                    <i data-lucide="lock" class="me-2"></i>
                    Đổi mật khẩu
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link @(isNotifications ? "active" : "")" href="@Url.Action("Notifications", "UserDashboard")">
                    <i data-lucide="bell" class="me-2"></i>
                    Thông báo
                </a>
            </li>
            <li class="nav-item">
                <form asp-action="Logout" asp-controller="Account" method="post" class="w-100">
                    <button type="submit" class="nav-link w-100 text-start logout-btn">
                        <i data-lucide="log-out" class="me-2"></i>
                        Đăng xuất
                    </button>
                </form>
            </li>
        </ul>
    </div>
</nav>
