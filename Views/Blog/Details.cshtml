@model JohnHenryFashionWeb.Models.BlogPost
@{
    ViewData["Title"] = Model.MetaTitle ?? Model.Title;
    ViewData["Description"] = Model.MetaDescription ?? Model.Excerpt;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@if (!string.IsNullOrEmpty(Model.MetaTitle))
{
    @section MetaTags {
        <meta name="title" content="@Model.MetaTitle">
        <meta name="description" content="@Model.MetaDescription">
        <meta property="og:title" content="@Model.MetaTitle">
        <meta property="og:description" content="@Model.MetaDescription">
        <meta property="og:image" content="@(Model.FeaturedImageUrl ?? "/images/logo-og.png")">
        <meta property="og:type" content="article">
        @if (Model.Tags != null)
        {
            <meta name="keywords" content="@string.Join(", ", Model.Tags)">
        }
    }
}

<div class="container my-5">
    <!-- Preview Banner for Drafts -->
    @if (ViewBag.IsPreview == true)
    {
        <div class="alert alert-info d-flex align-items-center justify-content-between mb-4" role="alert">
            <div>
                <i data-lucide="eye" style="width: 20px; height: 20px; display: inline-block; vertical-align: middle;"></i>
                <strong>Chế độ xem trước:</strong> @ViewBag.PreviewMessage
            </div>
            <div>
                <a asp-controller="Admin" asp-action="EditBlogPost" asp-route-id="@Model.Id" class="btn btn-sm btn-primary me-2">
                    <i data-lucide="edit" style="width: 16px; height: 16px;"></i> Chỉnh sửa
                </a>
                <a asp-controller="Admin" asp-action="Blog" class="btn btn-sm btn-outline-secondary">
                    <i data-lucide="arrow-left" style="width: 16px; height: 16px;"></i> Quay lại
                </a>
            </div>
        </div>
    }

    <div class="row justify-content-center">
        <!-- Main Content - Centered -->
        <div class="col-lg-10 col-xl-9">
            <article class="blog-post">
                <!-- Post Header -->
                <header class="mb-5 text-center">
                    <h1 class="display-4 fw-bold mb-4">@Model.Title</h1>
                    
                    <div class="post-meta mb-4">
                        <div class="d-flex flex-wrap justify-content-center align-items-center text-muted">
                            @if (Model.Category != null)
                            {
                                <span class="badge bg-primary me-3 px-3 py-2">@Model.Category.Name.ToUpper()</span>
                            }
                            <span class="me-3">
                                <i class="fas fa-calendar-alt me-1"></i>
                                @((Model.PublishedAt ?? Model.CreatedAt).ToString("dd/MM/yyyy"))
                            </span>
                            <span class="me-3">
                                <i class="fas fa-eye me-1"></i>
                                @Model.ViewCount lượt xem
                            </span>
                        </div>
                        
                        @if (Model.Tags != null && Model.Tags.Any())
                        {
                            <div class="mt-3">
                                <span class="text-muted me-2">Tags:</span>
                                @foreach (var tag in Model.Tags)
                                {
                                    <span class="badge bg-light text-dark me-2">#@tag</span>
                                }
                            </div>
                        }
                    </div>
                </header>

                <!-- Featured Image -->
                @if (!string.IsNullOrEmpty(Model.FeaturedImageUrl))
                {
                    <div class="featured-image mb-5">
                        <img src="@Model.FeaturedImageUrl" class="img-fluid shadow-lg w-100" alt="@Model.Title" style="max-height: 600px; object-fit: cover;">
                    </div>
                }

                <!-- Post Excerpt -->
                @if (!string.IsNullOrEmpty(Model.Excerpt))
                {
                    <div class="lead text-muted mb-5 text-center fst-italic px-lg-5">
                        @Model.Excerpt
                    </div>
                }

                <!-- Post Content -->
                <div class="post-content fs-5 lh-lg">
                    @Html.Raw(Model.Content)
                </div>

                <!-- Post Footer -->
                <footer class="post-footer mt-5 pt-5 border-top">
                    <div class="row align-items-center">
                        <div class="col-md-6 mb-3 mb-md-0">
                            @if (Model.Tags != null && Model.Tags.Any())
                            {
                                <div class="tags">
                                    <strong class="me-2">Tags:</strong>
                                    @foreach (var tag in Model.Tags)
                                    {
                                        <a href="@Url.Action("Index", "Blog", new { search = tag })" class="badge bg-light text-dark text-decoration-none me-2">#@tag</a>
                                    }
                                </div>
                            }
                        </div>
                        <div class="col-md-6 text-md-end">
                            <div class="share-buttons">
                                <span class="me-2 fw-bold">Chia sẻ:</span>
                                <a href="https://www.facebook.com/sharer/sharer.php?u=@Context.Request.Scheme://@Context.Request.Host@Context.Request.Path" 
                                   target="_blank" class="btn btn-primary btn-sm me-2" title="Chia sẻ trên Facebook">
                                    <i class="fab fa-facebook-f"></i> Facebook
                                </a>
                                <a href="https://www.instagram.com/" 
                                   target="_blank" class="btn btn-sm me-2" style="background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%); color: white;" title="Chia sẻ trên Instagram">
                                    <i class="fab fa-instagram"></i> Instagram
                                </a>
                            </div>
                        </div>
                    </div>
                </footer>
            </article>
        </div>
    </div>

    <!-- Related Posts Section - Full Width -->
    @if (ViewBag.RelatedPosts != null && ((List<JohnHenryFashionWeb.Models.BlogPost>)ViewBag.RelatedPosts).Any())
    {
        <section class="related-posts mt-5 pt-5 border-top">
            <div class="row">
                <div class="col-12">
                    <h2 class="text-center mb-5 fw-bold">BÀI VIẾT LIÊN QUAN</h2>
                </div>
            </div>
            <div class="row g-4">
                @foreach (var related in (List<JohnHenryFashionWeb.Models.BlogPost>)ViewBag.RelatedPosts)
                {
                    <div class="col-lg-4 col-md-6">
                        <div class="card border-0 shadow-sm h-100 blog-card-hover">
                            @if (!string.IsNullOrEmpty(related.FeaturedImageUrl))
                            {
                                <a asp-action="Details" asp-route-slug="@related.Slug">
                                    <img src="@related.FeaturedImageUrl" class="card-img-top" alt="@related.Title" style="height: 250px; object-fit: cover;">
                                </a>
                            }
                            else
                            {
                                <a asp-action="Details" asp-route-slug="@related.Slug">
                                    <div class="bg-light d-flex align-items-center justify-content-center" style="height: 250px;">
                                        <i class="fas fa-image fa-3x text-muted"></i>
                                    </div>
                                </a>
                            }
                            <div class="card-body d-flex flex-column">
                                @if (related.Category != null)
                                {
                                    <span class="badge bg-primary mb-2 align-self-start">@related.Category.Name.ToUpper()</span>
                                }
                                <h5 class="card-title">
                                    <a asp-action="Details" asp-route-slug="@related.Slug" class="text-decoration-none text-dark stretched-link">
                                        @related.Title
                                    </a>
                                </h5>
                                @if (!string.IsNullOrEmpty(related.Excerpt))
                                {
                                    <p class="card-text text-muted flex-grow-1">
                                        @(related.Excerpt.Length > 120 ? related.Excerpt.Substring(0, 120) + "..." : related.Excerpt)
                                    </p>
                                }
                                <div class="mt-auto pt-3 border-top">
                                    <div class="d-flex justify-content-between align-items-center text-muted small">
                                        <span>
                                            <i class="fas fa-calendar-alt me-1"></i>
                                            @((related.PublishedAt ?? related.CreatedAt).ToString("dd/MM/yyyy"))
                                        </span>
                                        <span>
                                            <i class="fas fa-eye me-1"></i>
                                            @related.ViewCount
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </section>
    }
</div>

@section Scripts {
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        $(document).ready(function() {
            // Initialize Lucide icons
            lucide.createIcons();
            
            // Smooth scroll for anchor links
            $('a[href^="#"]').click(function(e) {
                e.preventDefault();
                var target = $(this.getAttribute('href'));
                if (target.length) {
                    $('html, body').animate({
                        scrollTop: target.offset().top - 100
                    }, 500);
                }
            });

            // Add hover effect to blog cards
            $('.blog-card-hover').hover(
                function() {
                    $(this).addClass('shadow-lg').css('transform', 'translateY(-5px)');
                },
                function() {
                    $(this).removeClass('shadow-lg').css('transform', 'translateY(0)');
                }
            );
        });
    </script>
    
    <style>
        /* Blog Post Styling */
        .blog-post header h1 {
            font-size: 2.5rem;
            line-height: 1.3;
            color: #1a1a1a;
            font-family: 'Lucida Grande', 'Arsenal', sans-serif !important;
        }

        .post-meta {
            font-size: 0.95rem;
        }

        .post-meta .badge {
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        .post-content {
            color: #333;
            line-height: 1.8;
        }

        .post-content h2 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 700;
            font-size: 1.75rem;
        }

        .post-content h3 {
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
            font-size: 1.4rem;
        }

        .post-content p {
            margin-bottom: 1.5rem;
        }

        .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 2rem 0;
        }

        .post-content ul, .post-content ol {
            margin-bottom: 1.5rem;
            padding-left: 2rem;
        }

        .post-content li {
            margin-bottom: 0.5rem;
        }

        .post-content blockquote {
            border-left: 4px solid #0d6efd;
            padding-left: 1.5rem;
            margin: 2rem 0;
            font-style: italic;
            color: #666;
        }

        .post-content code {
            background: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .post-content pre {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 2rem 0;
        }

        /* Related Posts Section */
        .related-posts h2 {
            font-size: 2rem;
            color: #1a1a1a;
            position: relative;
            padding-bottom: 1rem;
        }

        .related-posts h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #0d6efd, #0dcaf0);
        }

        .blog-card-hover {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .blog-card-hover:hover {
            transform: translateY(-5px);
        }

        .blog-card-hover .card-img-top {
            transition: transform 0.3s ease;
        }

        .blog-card-hover:hover .card-img-top {
            transform: scale(1.05);
            overflow: hidden;
        }

        .blog-card-hover .card-title a {
            color: #1a1a1a;
            transition: color 0.3s ease;
        }

        .blog-card-hover:hover .card-title a {
            color: #0d6efd;
        }

        /* Share Buttons */
        .share-buttons .btn {
            transition: all 0.3s ease;
        }

        .share-buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        /* Responsive */
        @@media (max-width: 768px) {
            .blog-post header h1 {
                font-size: 1.75rem;
            }

            .post-content {
                font-size: 1rem;
            }

            .related-posts h2 {
                font-size: 1.5rem;
            }
        }

        /* Preview Banner */
        .alert-info {
            border-left: 4px solid #0dcaf0;
        }
    </style>
}
