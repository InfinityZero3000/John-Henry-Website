@model JohnHenryFashionWeb.Models.Product
@{
    ViewData["Title"] = "Product Details";
}

<style>
    .glassmorphism {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .product-gradient {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .product-image-large {
        width: 100%;
        height: 400px;
        object-fit: cover;
        border-radius: 10px;
    }

    .product-image-thumb {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    .product-image-thumb:hover {
        transform: scale(1.1);
    }

    .status-badge {
        padding: 6px 16px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .status-active {
        background: rgba(76, 175, 80, 0.2);
        color: #4caf50;
        border: 1px solid rgba(76, 175, 80, 0.3);
    }

    .status-inactive {
        background: rgba(244, 67, 54, 0.2);
        color: #f44336;
        border: 1px solid rgba(244, 67, 54, 0.3);
    }

    .info-row {
        padding: 12px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .info-row:last-child {
        border-bottom: none;
    }
</style>

<div class="product-gradient min-vh-100 py-5">
    <div class="container">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glassmorphism p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="text-white mb-1">
                                <i class="fas fa-box me-2"></i>Product Details
                            </h2>
                            <p class="text-white-50 mb-0">Product #@Model.Id</p>
                        </div>
                        <a href="/admin/approvals/products" class="btn btn-outline-light">
                            <i class="fas fa-arrow-left me-2"></i>Back to Products
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Left Column: Product Images -->
            <div class="col-lg-5">
                <div class="glassmorphism p-4 mb-4">
                    @if (Model.GalleryImages != null && Model.GalleryImages.Any())
                    {
                        <img id="mainImage" src="@Model.GalleryImages.First()" alt="@Model.Name" class="product-image-large mb-3">
                        
                        @if (Model.GalleryImages.Length > 1)
                        {
                            <div class="d-flex gap-2 flex-wrap">
                                @foreach (var image in Model.GalleryImages)
                                {
                                    <img src="@image" alt="@Model.Name" class="product-image-thumb" onclick="changeMainImage('@image')">
                                }
                            </div>
                        }
                    }
                    else if (!string.IsNullOrEmpty(Model.FeaturedImageUrl))
                    {
                        <img id="mainImage" src="@Model.FeaturedImageUrl" alt="@Model.Name" class="product-image-large mb-3">
                    }
                    else
                    {
                        <div class="product-image-large bg-secondary d-flex align-items-center justify-content-center">
                            <i class="fas fa-image fa-5x text-white-50"></i>
                        </div>
                    }
                </div>

                <!-- Status & Actions -->
                <div class="glassmorphism p-4">
                    <h5 class="text-white mb-3">
                        <i class="fas fa-tasks me-2"></i>Product Status & Actions
                    </h5>
                    
                    <div class="mb-4">
                        <p class="text-white-50 mb-2">Current Status</p>
                        @switch (Model.Status)
                        {
                            case "active":
                                <span class="status-badge status-active">
                                    <i class="fas fa-check-circle me-1"></i>Active
                                </span>
                                break;
                            case "inactive":
                                <span class="status-badge status-inactive">
                                    <i class="fas fa-times-circle me-1"></i>Inactive
                                </span>
                                break;
                            case "out_of_stock":
                                <span class="status-badge status-inactive">
                                    <i class="fas fa-box-open me-1"></i>Out of Stock
                                </span>
                                break;
                        }
                    </div>

                    @if (Model.Status != "active" && Model.IsActive == false)
                    {
                        <form method="post" action="/admin/approvals/products/@Model.Id/activate">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-success w-100">
                                <i class="fas fa-check me-2"></i>Activate Product
                            </button>
                        </form>
                    }
                    
                    @if (Model.Status == "active" && Model.IsActive == true)
                    {
                        <button type="button" class="btn btn-danger w-100" onclick="showDeactivateModal()">
                            <i class="fas fa-ban me-2"></i>Deactivate Product
                        </button>
                    }
                </div>
            </div>

            <!-- Right Column: Product Information -->
            <div class="col-lg-7">
                <!-- Basic Information -->
                <div class="glassmorphism p-4 mb-4">
                    <h3 class="text-white mb-4">@Model.Name</h3>
                    
                    <div class="info-row">
                        <div class="row">
                            <div class="col-4">
                                <p class="text-white-50 mb-0">SKU</p>
                            </div>
                            <div class="col-8">
                                <p class="text-white mb-0">@Model.SKU</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="row">
                            <div class="col-4">
                                <p class="text-white-50 mb-0">Category</p>
                            </div>
                            <div class="col-8">
                                <p class="text-white mb-0">@Model.Category?.Name</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="row">
                            <div class="col-4">
                                <p class="text-white-50 mb-0">Brand</p>
                            </div>
                            <div class="col-8">
                                <p class="text-white mb-0">@Model.Brand?.Name</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="row">
                            <div class="col-4">
                                <p class="text-white-50 mb-0">Price</p>
                            </div>
                            <div class="col-8">
                                <p class="text-white mb-0 h5">@Model.Price.ToString("N0") VND</p>
                            </div>
                        </div>
                    </div>

                    @if (Model.SalePrice.HasValue && Model.SalePrice < Model.Price)
                    {
                        <div class="info-row">
                            <div class="row">
                                <div class="col-4">
                                    <p class="text-white-50 mb-0">Sale Price</p>
                                </div>
                                <div class="col-8">
                                    <p class="text-white mb-0">
                                        <s>@Model.Price.ToString("N0") VND</s>
                                        <span class="text-success h5 ms-2">@Model.SalePrice.Value.ToString("N0") VND</span>
                                        <span class="badge bg-danger ms-2">
                                            @(((Model.Price - Model.SalePrice.Value) / Model.Price * 100).ToString("0"))% OFF
                                        </span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    }

                    <div class="info-row">
                        <div class="row">
                            <div class="col-4">
                                <p class="text-white-50 mb-0">Stock</p>
                            </div>
                            <div class="col-8">
                                <p class="text-white mb-0">
                                    @Model.StockQuantity units
                                    @if (Model.StockQuantity < 10)
                                    {
                                        <span class="badge bg-warning ms-2">Low Stock</span>
                                    }
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div class="glassmorphism p-4 mb-4">
                    <h5 class="text-white mb-3">
                        <i class="fas fa-align-left me-2"></i>Description
                    </h5>
                    <p class="text-white-50 mb-0" style="line-height: 1.8;">
                        @Html.Raw(Model.Description)
                    </p>
                </div>

                <!-- Statistics -->
                <div class="glassmorphism p-4">
                    <h5 class="text-white mb-3">
                        <i class="fas fa-chart-bar me-2"></i>Statistics
                    </h5>

                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center p-3">
                                <i class="fas fa-eye fa-2x text-info mb-2"></i>
                                <h4 class="text-white mb-0">@Model.ViewCount</h4>
                                <small class="text-white-50">Views</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3">
                                <i class="fas fa-shopping-cart fa-2x text-success mb-2"></i>
                                <h4 class="text-white mb-0">@(Model.StockQuantity > 0 ? "In Stock" : "Out")</h4>
                                <small class="text-white-50">Stock Status</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3">
                                <i class="fas fa-star fa-2x text-warning mb-2"></i>
                                <h4 class="text-white mb-0">@(Model.Rating.HasValue ? Model.Rating.Value.ToString("0.0") : "N/A")</h4>
                                <small class="text-white-50">Rating</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3">
                                <i class="fas fa-comments fa-2x text-primary mb-2"></i>
                                <h4 class="text-white mb-0">@Model.ReviewCount</h4>
                                <small class="text-white-50">Reviews</small>
                            </div>
                        </div>
                    </div>

                    <hr class="border-light opacity-25 my-3">

                    <div class="info-row">
                        <div class="row">
                            <div class="col-6">
                                <p class="text-white-50 mb-0">Created At</p>
                            </div>
                            <div class="col-6 text-end">
                                <p class="text-white mb-0">@Model.CreatedAt.ToString("MMM dd, yyyy HH:mm")</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="row">
                            <div class="col-6">
                                <p class="text-white-50 mb-0">Last Updated</p>
                            </div>
                            <div class="col-6 text-end">
                                <p class="text-white mb-0">@Model.UpdatedAt.ToString("MMM dd, yyyy HH:mm")</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="row">
                            <div class="col-6">
                                <p class="text-white-50 mb-0">Featured Product</p>
                            </div>
                            <div class="col-6 text-end">
                                <p class="text-white mb-0">
                                    @if (Model.IsFeatured)
                                    {
                                        <i class="fas fa-check-circle text-success"></i>
                                        <span>Yes</span>
                                    }
                                    else
                                    {
                                        <i class="fas fa-times-circle text-danger"></i>
                                        <span>No</span>
                                    }
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Deactivate Modal -->
<div class="modal fade" id="deactivateModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header border-secondary">
                <h5 class="modal-title text-white">Deactivate Product</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="/admin/approvals/products/@Model.Id/deactivate">
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <p class="text-white mb-3">Are you sure you want to deactivate <strong>@Model.Name</strong>?</p>
                    <div class="mb-3">
                        <label class="form-label text-white">Reason (Optional)</label>
                        <textarea name="reason" class="form-control" rows="3" placeholder="Enter reason for deactivating this product..."></textarea>
                        <small class="text-white-50">This reason will be logged for administrative purposes.</small>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-ban me-2"></i>Deactivate Product
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function changeMainImage(imageUrl) {
            document.getElementById('mainImage').src = imageUrl;
        }

        function showDeactivateModal() {
            const modal = new bootstrap.Modal(document.getElementById('deactivateModal'));
            modal.show();
        }
    </script>
}
