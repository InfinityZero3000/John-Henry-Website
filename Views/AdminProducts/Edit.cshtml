@model JohnHenryFashionWeb.Models.Product
@{
    ViewData["Title"] = "Sửa sản phẩm";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col">
            <h2>Sửa sản phẩm</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/admin/products">Quản lý sản phẩm</a></li>
                    <li class="breadcrumb-item active">Sửa</li>
                </ol>
            </nav>
        </div>
    </div>

    <form method="post" enctype="multipart/form-data" asp-action="Edit">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="Id" />
        
        <div class="row">
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Thông tin cơ bản</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label asp-for="Name" class="form-label">Tên sản phẩm <span class="text-danger">*</span></label>
                            <input asp-for="Name" class="form-control" placeholder="Nhập tên sản phẩm" required />
                            <span asp-validation-for="Name" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="SKU" class="form-label">SKU <span class="text-danger">*</span></label>
                            <input asp-for="SKU" class="form-control" placeholder="Nhập mã SKU" required />
                            <span asp-validation-for="SKU" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Price" class="form-label">Giá bán <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <input asp-for="Price" type="number" class="form-control" placeholder="0" required />
                                    <span class="input-group-text">₫</span>
                                </div>
                                <span asp-validation-for="Price" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="SalePrice" class="form-label">Giá khuyến mãi</label>
                                <div class="input-group">
                                    <input asp-for="SalePrice" type="number" class="form-control" placeholder="0" />
                                    <span class="input-group-text">₫</span>
                                </div>
                                <span asp-validation-for="SalePrice" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="StockQuantity" class="form-label">Số lượng tồn kho <span class="text-danger">*</span></label>
                            <input asp-for="StockQuantity" type="number" class="form-control" placeholder="0" required />
                            <span asp-validation-for="StockQuantity" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label asp-for="Size" class="form-label">Kích thước</label>
                                <input asp-for="Size" class="form-control" placeholder="S, M, L, XL..." />
                            </div>

                            <div class="col-md-4 mb-3">
                                <label asp-for="Color" class="form-label">Màu sắc</label>
                                <input asp-for="Color" class="form-control" placeholder="Đỏ, Xanh..." />
                            </div>

                            <div class="col-md-4 mb-3">
                                <label asp-for="Material" class="form-label">Chất liệu</label>
                                <input asp-for="Material" class="form-control" placeholder="Cotton, Polyester..." />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Phân loại</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label asp-for="CategoryId" class="form-label">Danh mục <span class="text-danger">*</span></label>
                            <select asp-for="CategoryId" class="form-select" asp-items="ViewBag.Categories" required>
                                <option value="">-- Chọn danh mục --</option>
                            </select>
                            <span asp-validation-for="CategoryId" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="BrandId" class="form-label">Thương hiệu</label>
                            <select asp-for="BrandId" class="form-select" asp-items="ViewBag.Brands">
                                <option value="">-- Chọn thương hiệu --</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input asp-for="IsFeatured" class="form-check-input" type="checkbox" />
                                <label asp-for="IsFeatured" class="form-check-label">
                                    Sản phẩm nổi bật
                                </label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input asp-for="IsActive" class="form-check-input" type="checkbox" />
                                <label asp-for="IsActive" class="form-check-label">
                                    Hiển thị sản phẩm
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Hình ảnh</h5>
                    </div>
                    <div class="card-body">
                        @if (!string.IsNullOrEmpty(Model.FeaturedImageUrl))
                        {
                            <div class="mb-3 text-center">
                                <img src="@Model.FeaturedImageUrl" alt="@Model.Name" class="img-fluid rounded" style="max-height: 200px;" />
                                <p class="text-muted mt-2"><small>Hình ảnh hiện tại</small></p>
                            </div>
                        }
                        <div class="mb-3">
                            <label for="imageFile" class="form-label">Thay đổi hình ảnh</label>
                            <input type="file" name="imageFile" id="imageFile" class="form-control" accept="image/*" onchange="previewImage(this)" />
                            <small class="text-muted">Định dạng: JPG, PNG, GIF. Tối đa 5MB. Để trống nếu không muốn thay đổi.</small>
                        </div>
                        <div id="imagePreview" class="text-center" style="display: none;">
                            <img id="preview" src="" alt="Preview" class="img-fluid rounded" style="max-height: 200px;" />
                            <p class="text-muted mt-2"><small>Hình ảnh mới</small></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Cập nhật sản phẩm
                </button>
                <a href="/admin/products" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Hủy
                </a>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        function previewImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
