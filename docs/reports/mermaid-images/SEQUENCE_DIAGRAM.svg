<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="2800" viewBox="0 0 1400 2800">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#34495e"/>
    </marker>
  </defs>
  
  <rect width="1400" height="2800" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="700" y="40" font-family="Arial" font-size="24" font-weight="bold" fill="#2c3e50" text-anchor="middle">SEQUENCE DIAGRAM - John Henry Fashion</text>
  <text x="700" y="70" font-family="Arial" font-size="13" fill="#7f8c8d" text-anchor="middle">Complete User Flow: Login to Add Cart to Checkout to Payment to Success</text>
  
  <!-- Actors/Components Header -->
  <rect x="80" y="100" width="120" height="50" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="5"/>
  <text x="140" y="130" font-family="Arial" font-size="12" fill="white" text-anchor="middle" font-weight="bold">User</text>
  
  <rect x="240" y="100" width="140" height="50" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="5"/>
  <text x="310" y="130" font-family="Arial" font-size="12" fill="white" text-anchor="middle" font-weight="bold">Browser</text>
  
  <rect x="420" y="100" width="140" height="50" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="5"/>
  <text x="490" y="130" font-family="Arial" font-size="12" fill="white" text-anchor="middle" font-weight="bold">Controllers</text>
  
  <rect x="600" y="100" width="140" height="50" fill="#f39c12" stroke="#e67e22" stroke-width="2" rx="5"/>
  <text x="670" y="130" font-family="Arial" font-size="12" fill="white" text-anchor="middle" font-weight="bold">Services</text>
  
  <rect x="780" y="100" width="140" height="50" fill="#27ae60" stroke="#229954" stroke-width="2" rx="5"/>
  <text x="850" y="130" font-family="Arial" font-size="12" fill="white" text-anchor="middle" font-weight="bold">Database</text>
  
  <rect x="960" y="100" width="140" height="50" fill="#ea4335" stroke="#c23321" stroke-width="2" rx="5"/>
  <text x="1030" y="130" font-family="Arial" font-size="12" fill="white" text-anchor="middle" font-weight="bold">Google OAuth</text>
  
  <rect x="1140" y="100" width="140" height="50" fill="#1abc9c" stroke="#16a085" stroke-width="2" rx="5"/>
  <text x="1210" y="130" font-family="Arial" font-size="12" fill="white" text-anchor="middle" font-weight="bold">Payment Gateway</text>
  
  <!-- Lifelines -->
  <line x1="140" y1="150" x2="140" y2="2750" stroke="#95a5a6" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="310" y1="150" x2="310" y2="2750" stroke="#95a5a6" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="490" y1="150" x2="490" y2="2750" stroke="#95a5a6" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="670" y1="150" x2="670" y2="2750" stroke="#95a5a6" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="850" y1="150" x2="850" y2="2750" stroke="#95a5a6" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="1030" y1="150" x2="1030" y2="2750" stroke="#95a5a6" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="1210" y1="150" x2="1210" y2="2750" stroke="#95a5a6" stroke-width="2" stroke-dasharray="5,5"/>
  
  <!-- PHASE 1: Google OAuth Login -->
  <rect x="30" y="180" width="240" height="35" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2" rx="5"/>
  <text x="150" y="203" font-family="Arial" font-size="14" fill="#2c3e50" font-weight="bold">PHASE 1: OAuth Login</text>
  
  <line x1="140" y1="240" x2="310" y2="240" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="225" y="228" font-family="Arial" font-size="10" fill="#2c3e50">1. Click "Login with Google"</text>
  
  <line x1="310" y1="280" x2="490" y2="280" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="268" font-family="Arial" font-size="10" fill="#2c3e50">2. GET /Account/Login</text>
  
  <line x1="490" y1="320" x2="1030" y2="320" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="760" y="308" font-family="Arial" font-size="10" fill="#2c3e50">3. Redirect to Google OAuth</text>
  
  <line x1="1030" y1="360" x2="310" y2="360" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="348" font-family="Arial" font-size="10" fill="#2c3e50">4. User authenticates</text>
  
  <line x1="1030" y1="400" x2="490" y2="400" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="760" y="388" font-family="Arial" font-size="10" fill="#2c3e50">5. Return auth code</text>
  
  <line x1="490" y1="440" x2="1030" y2="440" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="760" y="428" font-family="Arial" font-size="10" fill="#2c3e50">6. Exchange code for token</text>
  
  <line x1="1030" y1="480" x2="490" y2="480" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="760" y="468" font-family="Arial" font-size="10" fill="#2c3e50">7. Return user info</text>
  
  <line x1="490" y1="520" x2="850" y2="520" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="508" font-family="Arial" font-size="10" fill="#2c3e50">8. Create/Update User</text>
  
  <line x1="850" y1="560" x2="490" y2="560" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="548" font-family="Arial" font-size="10" fill="#2c3e50">9. UserId (GUID)</text>
  
  <rect x="470" y="580" width="40" height="20" fill="#9b59b6"/>
  <text x="490" y="595" font-family="Arial" font-size="9" fill="white" text-anchor="middle">Auth</text>
  
  <line x1="490" y1="620" x2="310" y2="620" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="608" font-family="Arial" font-size="10" fill="#2c3e50">10. Set auth cookie</text>
  
  <line x1="310" y1="660" x2="140" y2="660" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="225" y="648" font-family="Arial" font-size="10" fill="#2c3e50">11. Redirect to Home</text>
  
  <!-- PHASE 2: Add to Cart -->
  <rect x="30" y="710" width="240" height="35" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2" rx="5"/>
  <text x="150" y="733" font-family="Arial" font-size="14" fill="#2c3e50" font-weight="bold">PHASE 2: Add to Cart</text>
  
  <line x1="140" y1="770" x2="310" y2="770" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="225" y="758" font-family="Arial" font-size="10" fill="#2c3e50">12. Click "Add to Cart"</text>
  
  <line x1="310" y1="810" x2="490" y2="810" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="798" font-family="Arial" font-size="10" fill="#2c3e50">13. POST /Products/AddToCart</text>
  
  <rect x="470" y="830" width="40" height="20" fill="#e74c3c"/>
  <text x="490" y="845" font-family="Arial" font-size="8" fill="white" text-anchor="middle">Check</text>
  
  <line x1="490" y1="870" x2="490" y2="890" stroke="#34495e" stroke-width="2"/>
  <text x="520" y="883" font-family="Arial" font-size="9" fill="#e74c3c">14. Get UserId from Claims</text>
  
  <line x1="490" y1="920" x2="850" y2="920" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="908" font-family="Arial" font-size="10" fill="#2c3e50">15. Find Product by SKU</text>
  
  <line x1="850" y1="960" x2="490" y2="960" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="948" font-family="Arial" font-size="10" fill="#2c3e50">16. Product details</text>
  
  <line x1="490" y1="1000" x2="850" y2="1000" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="988" font-family="Arial" font-size="10" fill="#2c3e50">17. Check existing cart item</text>
  
  <line x1="850" y1="1040" x2="490" y2="1040" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="1028" font-family="Arial" font-size="10" fill="#2c3e50">18. Existing item or null</text>
  
  <rect x="470" y="1060" width="40" height="20" fill="#9b59b6"/>
  <text x="490" y="1075" font-family="Arial" font-size="8" fill="white" text-anchor="middle">Logic</text>
  
  <line x1="490" y1="1100" x2="850" y2="1100" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="1088" font-family="Arial" font-size="10" fill="#2c3e50">19. INSERT/UPDATE ShoppingCartItem</text>
  <text x="670" y="1105" font-family="Arial" font-size="9" fill="#e74c3c">(UserId + ProductId + Quantity)</text>
  
  <line x1="850" y1="1130" x2="490" y2="1130" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="1118" font-family="Arial" font-size="10" fill="#27ae60">20. Success</text>
  
  <line x1="490" y1="1170" x2="310" y2="1170" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="1158" font-family="Arial" font-size="10" fill="#2c3e50">21. JSON: success + cartCount</text>
  
  <line x1="310" y1="1210" x2="140" y2="1210" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="225" y="1198" font-family="Arial" font-size="10" fill="#2c3e50">22. Update cart badge UI</text>
  
  <!-- PHASE 3: Checkout -->
  <rect x="30" y="1260" width="240" height="35" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2" rx="5"/>
  <text x="150" y="1283" font-family="Arial" font-size="14" fill="#2c3e50" font-weight="bold">PHASE 3: Checkout</text>
  
  <line x1="140" y1="1320" x2="310" y2="1320" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="225" y="1308" font-family="Arial" font-size="10" fill="#2c3e50">23. Click "Checkout"</text>
  
  <line x1="310" y1="1360" x2="490" y2="1360" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="1348" font-family="Arial" font-size="10" fill="#2c3e50">24. POST /Cart/SaveSelectedItems</text>
  
  <rect x="470" y="1380" width="40" height="20" fill="#9b59b6"/>
  <text x="490" y="1395" font-family="Arial" font-size="8" fill="white" text-anchor="middle">Save</text>
  
  <line x1="490" y1="1420" x2="310" y2="1420" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="1408" font-family="Arial" font-size="10" fill="#2c3e50">25. Store selectedIds in Session</text>
  
  <line x1="310" y1="1460" x2="490" y2="1460" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="1448" font-family="Arial" font-size="10" fill="#2c3e50">26. GET /Checkout</text>
  
  <line x1="490" y1="1500" x2="850" y2="1500" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="1488" font-family="Arial" font-size="10" fill="#2c3e50">27. Query ShoppingCartItems</text>
  <text x="670" y="1505" font-family="Arial" font-size="9" fill="#e74c3c">WHERE UserId = current AND Id IN selectedIds</text>
  
  <line x1="850" y1="1530" x2="490" y2="1530" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="1518" font-family="Arial" font-size="10" fill="#27ae60">28. Cart items list</text>
  
  <line x1="490" y1="1570" x2="310" y2="1570" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="1558" font-family="Arial" font-size="10" fill="#2c3e50">29. Render Checkout form</text>
  
  <line x1="140" y1="1610" x2="310" y2="1610" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="225" y="1598" font-family="Arial" font-size="10" fill="#2c3e50">30. Fill shipping info + Submit</text>
  
  <line x1="310" y1="1650" x2="490" y2="1650" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="1638" font-family="Arial" font-size="10" fill="#2c3e50">31. POST /Checkout/CreateSession</text>
  
  <rect x="470" y="1670" width="40" height="20" fill="#e74c3c"/>
  <text x="490" y="1685" font-family="Arial" font-size="8" fill="white" text-anchor="middle">Valid</text>
  
  <line x1="490" y1="1710" x2="850" y2="1710" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="1698" font-family="Arial" font-size="10" fill="#2c3e50">32. INSERT CheckoutSession</text>
  <text x="670" y="1715" font-family="Arial" font-size="9" fill="#e74c3c">(UserId, SessionId, TotalAmount, ExpiresAt)</text>
  
  <line x1="490" y1="1740" x2="850" y2="1740" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="1728" font-family="Arial" font-size="10" fill="#2c3e50">33. INSERT CheckoutSessionItems</text>
  
  <line x1="850" y1="1780" x2="490" y2="1780" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="1768" font-family="Arial" font-size="10" fill="#27ae60">34. Success with sessionId</text>
  
  <line x1="490" y1="1820" x2="310" y2="1820" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="1808" font-family="Arial" font-size="10" fill="#2c3e50">35. JSON: success + sessionId</text>
  
  <line x1="310" y1="1860" x2="490" y2="1860" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="1848" font-family="Arial" font-size="10" fill="#2c3e50">36. Redirect to /Payment?sessionId=xxx</text>
  
  <!-- PHASE 4: Payment -->
  <rect x="30" y="1910" width="240" height="35" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2" rx="5"/>
  <text x="150" y="1933" font-family="Arial" font-size="14" fill="#2c3e50" font-weight="bold">PHASE 4: Payment</text>
  
  <line x1="310" y1="1970" x2="490" y2="1970" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="1958" font-family="Arial" font-size="10" fill="#2c3e50">37. GET /Checkout/Payment</text>
  
  <line x1="490" y1="2010" x2="850" y2="2010" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="1998" font-family="Arial" font-size="10" fill="#2c3e50">38. Load CheckoutSession by sessionId</text>
  
  <line x1="850" y1="2050" x2="490" y2="2050" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="2038" font-family="Arial" font-size="10" fill="#27ae60">39. Session data</text>
  
  <rect x="470" y="2070" width="40" height="20" fill="#e74c3c"/>
  <text x="490" y="2085" font-family="Arial" font-size="8" fill="white" text-anchor="middle">Check</text>
  
  <line x1="490" y1="2110" x2="490" y2="2130" stroke="#34495e" stroke-width="2"/>
  <text x="520" y="2123" font-family="Arial" font-size="9" fill="#e74c3c">40. Validate: session.UserId == current</text>
  
  <line x1="490" y1="2160" x2="310" y2="2160" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="2148" font-family="Arial" font-size="10" fill="#2c3e50">41. Render Payment form</text>
  
  <line x1="140" y1="2200" x2="310" y2="2200" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="225" y="2188" font-family="Arial" font-size="10" fill="#2c3e50">42. Select payment method + Submit</text>
  
  <line x1="310" y1="2240" x2="490" y2="2240" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="2228" font-family="Arial" font-size="10" fill="#2c3e50">43. POST /Checkout/ProcessPayment</text>
  
  <rect x="470" y="2260" width="40" height="20" fill="#e74c3c"/>
  <text x="490" y="2275" font-family="Arial" font-size="8" fill="white" text-anchor="middle">Valid</text>
  
  <line x1="490" y1="2300" x2="670" y2="2300" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="580" y="2288" font-family="Arial" font-size="10" fill="#2c3e50">44. PaymentService.Process</text>
  
  <line x1="670" y1="2340" x2="1210" y2="2340" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="940" y="2328" font-family="Arial" font-size="10" fill="#2c3e50">45. Call Gateway API</text>
  
  <line x1="1210" y1="2380" x2="670" y2="2380" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="940" y="2368" font-family="Arial" font-size="10" fill="#27ae60">46. Payment URL or Success</text>
  
  <line x1="670" y1="2420" x2="850" y2="2420" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="760" y="2408" font-family="Arial" font-size="10" fill="#2c3e50">47. INSERT Order</text>
  <text x="760" y="2425" font-family="Arial" font-size="9" fill="#e74c3c">(UserId from session, OrderNumber, Items)</text>
  
  <line x1="670" y1="2450" x2="850" y2="2450" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="760" y="2438" font-family="Arial" font-size="10" fill="#2c3e50">48. LOG PaymentAttempt (UserId)</text>
  
  <line x1="850" y1="2490" x2="670" y2="2490" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="760" y="2478" font-family="Arial" font-size="10" fill="#27ae60">49. Success</text>
  
  <line x1="670" y1="2530" x2="490" y2="2530" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="580" y="2518" font-family="Arial" font-size="10" fill="#27ae60">50. Payment result</text>
  
  <line x1="490" y1="2570" x2="310" y2="2570" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="2558" font-family="Arial" font-size="10" fill="#2c3e50">51. Redirect to /Success?orderId=xxx</text>
  
  <!-- PHASE 5: Success -->
  <rect x="30" y="2620" width="240" height="35" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2" rx="5"/>
  <text x="150" y="2643" font-family="Arial" font-size="14" fill="#2c3e50" font-weight="bold">PHASE 5: Success</text>
  
  <line x1="310" y1="2680" x2="490" y2="2680" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="2668" font-family="Arial" font-size="10" fill="#2c3e50">52. GET /Checkout/Success</text>
  
  <line x1="490" y1="2720" x2="850" y2="2720" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="2708" font-family="Arial" font-size="10" fill="#2c3e50">53. Load Order by orderId</text>
  
  <rect x="470" y="2740" width="40" height="20" fill="#e74c3c"/>
  <text x="490" y="2755" font-family="Arial" font-size="8" fill="white" text-anchor="middle">Check</text>
  
  <line x1="490" y1="2780" x2="490" y2="2800" stroke="#34495e" stroke-width="2"/>
  <text x="520" y="2793" font-family="Arial" font-size="9" fill="#e74c3c">54. Validate: order.UserId == current</text>
  
  <line x1="490" y1="2830" x2="850" y2="2830" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="670" y="2818" font-family="Arial" font-size="10" fill="#2c3e50">55. DELETE ShoppingCartItems WHERE UserId</text>
  
  <line x1="490" y1="2870" x2="310" y2="2870" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="400" y="2858" font-family="Arial" font-size="10" fill="#2c3e50">56. Render Success page with order details</text>
  
  <line x1="310" y1="2910" x2="140" y2="2910" stroke="#34495e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="225" y="2898" font-family="Arial" font-size="10" fill="#27ae60">57. Display: Order confirmed!</text>
  
  <!-- Footer -->
  <text x="700" y="2770" font-family="Arial" font-size="10" fill="#95a5a6" text-anchor="middle">Generated: October 26, 2025 | John Henry Fashion E-commerce Platform</text>
</svg>
